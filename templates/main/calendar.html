{%extends 'base.html'%}
{% load static %}
{% block title %}
| Calendar
{% endblock  %}
{%block content%}
{% include 'partials/_menu.html' %}

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<div class="calendar__box" id="calendar">
    <div class="calendar__items" id="budget-calendar">
      
        
<div class="calendar disable-selection" >
   
    <div class="right-side">
        <div class="text-right calendar-change-year">
            <div class="calendar-change-year-slider">
                <span class="fa fa-caret-left cursor-pointer calendar-change-year-slider-prev"></span>
                <span class="calendar-current-year"></span>
                <span class="fa fa-caret-right cursor-pointer calendar-change-year-slider-next"></span>
            </div>
        </div>
        <div class="calendar-month-list">
            <ul class="calendar-month"></ul>
        </div>
        <div class="calendar-week-list">
            <ul class="calendar-week"></ul>
        </div>
        <div class="calendar-day-list">
            <ul class="calendar-days"></ul>
        </div>
    </div>
</div>

    </div>
    {% if user.usermembership.language.id == 1 %} 
    <div class="calendar__items" id="budget-calendar-2">
       
        <h1 class="calendar__heading calendar__heading-2 display_day"></h1>
        <h1 class="calendar__heading calendar-left-side-day-of-week"></h1>
        <h1 class="calendar__heading">Work in Progress !</h1>


    </div>
{%endif%}
    {% if user.usermembership.language.id == 2 %} 
    <div class="calendar__items" id="budget-calendar-2">
       
        <h1 class="calendar__heading calendar__heading-2 display_day"></h1>
        <h1 class="calendar__heading calendar-left-side-day-of-week"></h1>

        <h1 class="calendar__heading">Работа В Процессе !</h1>

    </div>
{%endif%}
{% if user.usermembership.language.id == 4 %} 
<div class="calendar__items" id="budget-calendar-2">
   
    <h1 class="calendar__heading calendar__heading-2 display_day"></h1>
    <h1 class="calendar__heading calendar-left-side-day-of-week"></h1>

    <h1 class="calendar__heading">Робота в Процесі !</h1>

</div>
{%endif%}


</div>

<script async>
{% if user.usermembership.language.id == 1 %}

const AVAILABLE_WEEK_DAYS = ['Sunday','Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
const localStorageName = 'calendar-events';

class CALENDAR {
constructor(options) {
    this.options = options;
    this.elements = {
        days: this.getFirstElementInsideIdByClassName('calendar-days'),
        week: this.getFirstElementInsideIdByClassName('calendar-week'),
        month: this.getFirstElementInsideIdByClassName('calendar-month'),
        year: this.getFirstElementInsideIdByClassName('calendar-current-year'),
        currentDay: this.getFirstElementInsideIdByClassName('display_day'),
        currentWeekDay: this.getFirstElementInsideIdByClassName('calendar-left-side-day-of-week'),
        prevYear: this.getFirstElementInsideIdByClassName('calendar-change-year-slider-prev'),
        nextYear: this.getFirstElementInsideIdByClassName('calendar-change-year-slider-next')
    };



    this.date = +new Date();
    this.options.maxDays = 37;
    this.init();
}

// App methods
init() {
    if (!this.options.id) return false;
    this.eventsTrigger();
    this.drawAll();
}

// draw Methods
drawAll() {
    this.drawWeekDays();
    this.drawMonths();
    this.drawDays();
    this.drawYearAndCurrentDay();
    this.drawEvents();

}


drawYearAndCurrentDay() {
    let calendar = this.getCalendar();
    this.elements.year.innerHTML = calendar.active.year;
    this.elements.currentDay.innerHTML = calendar.active.day;
    this.elements.currentWeekDay.innerHTML = AVAILABLE_WEEK_DAYS[calendar.active.week];
}

drawDays() {
    let calendar = this.getCalendar();

    let latestDaysInPrevMonth = this.range(calendar.active.startWeek).map((day, idx) => {
        return {
            dayNumber: this.countOfDaysInMonth(calendar.pMonth) - idx,
            month: new Date(calendar.pMonth).getMonth(),
            year: new Date(calendar.pMonth).getFullYear(),
            currentMonth: false
        }
    }).reverse();


    let daysInActiveMonth = this.range(calendar.active.days).map((day, idx) => {
        let dayNumber = idx + 1;
        let today = new Date();
        return {
            dayNumber,
            today: today.getDate() === dayNumber && today.getFullYear() === calendar.active.year && today.getMonth() === calendar.active.month,
            month: calendar.active.month,
            year: calendar.active.year,
            selected: calendar.active.day === dayNumber,
            currentMonth: true
        }
    });


    let countOfDays = this.options.maxDays - (latestDaysInPrevMonth.length + daysInActiveMonth.length);
    let daysInNextMonth = this.range(countOfDays).map((day, idx) => {
        return {
            dayNumber: idx + 1,
            month: new Date(calendar.nMonth).getMonth(),
            year: new Date(calendar.nMonth).getFullYear(),
            currentMonth: false
        }
    });

    let days = [...latestDaysInPrevMonth, ...daysInActiveMonth, ...daysInNextMonth];

    days = days.map(day => {
        let newDayParams = day;
        let formatted = this.getFormattedDate(new Date(`${Number(day.month)}/${day.dayNumber}/${day.year}`));

        return newDayParams;
    });

    let daysTemplate = "";
    days.forEach(day => {
        daysTemplate += `<li class="${day.currentMonth ? '' : 'another-month'}${day.today ? ' active-day ' : ''}${day.selected ? 'selected-day' : ''}${day.hasEvent ? ' event-day' : ''}" data-day="${day.dayNumber}" data-month="${day.month}" data-year="${day.year}"></li>`
    });

    this.elements.days.innerHTML = daysTemplate;
}

drawMonths() {
    let availableMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    let monthTemplate = "";
    let calendar = this.getCalendar();
    availableMonths.forEach((month, idx) => {
        monthTemplate += `<li class="${idx === calendar.active.month ? 'active' : ''}" data-month="${idx}">${month}</li>`
    });

    this.elements.month.innerHTML = monthTemplate;
}

drawWeekDays() {
    let weekTemplate = "";
    AVAILABLE_WEEK_DAYS.forEach(week => {
        weekTemplate += `<li>${week.slice(0, 3)}</li>`
    });

    this.elements.week.innerHTML = weekTemplate;
}

// Service methods
eventsTrigger() {
    this.elements.prevYear.addEventListener('click', e => {
        let calendar = this.getCalendar();
        this.updateTime(calendar.pYear);
        this.drawAll()
    });

    this.elements.nextYear.addEventListener('click', e => {
        let calendar = this.getCalendar();
        this.updateTime(calendar.nYear);
        this.drawAll()
    });

    this.elements.month.addEventListener('click', e => {
        let calendar = this.getCalendar();
        let month = e.srcElement.getAttribute('data-month');
        if (!month || calendar.active.month == month) return false;

        let newMonth = new Date(calendar.active.tm).setMonth(month);
        this.updateTime(newMonth);
        this.drawAll()
    });


    this.elements.days.addEventListener('click', e => {
        let element = e.srcElement;
        let day = element.getAttribute('data-day');
        let month = element.getAttribute('data-month');
        let year = element.getAttribute('data-year');
        if (!day) return false;
        let strDate = `${Number(month) + 1}/${day}/${year}`;
        this.updateTime(strDate);
        this.drawAll()
    });


   


}


updateTime(time) {
    this.date = +new Date(time);
}

getCalendar() {
    let time = new Date(this.date);

    return {
        active: {
            days: this.countOfDaysInMonth(time),
            startWeek: this.getStartedDayOfWeekByTime(time),
            day: time.getDate(),
            week: time.getDay(),
            month: time.getMonth(),
            year: time.getFullYear(),
            formatted: this.getFormattedDate(time),
            tm: +time
        },
        pMonth: new Date(time.getFullYear(), time.getMonth() - 1, 1),
        nMonth: new Date(time.getFullYear(), time.getMonth() + 1, 1),
        pYear: new Date(new Date(time).getFullYear() - 1, 0, 1),
        nYear: new Date(new Date(time).getFullYear() + 1, 0, 1)
    }
}

countOfDaysInMonth(time) {
    let date = this.getMonthAndYear(time);
    return new Date(date.year, date.month + 1, 0).getDate();
}

getStartedDayOfWeekByTime(time) {
    let date = this.getMonthAndYear(time);
    return new Date(date.year, date.month, ).getDay();
}


getMonthAndYear(time) {
    let date = new Date(time);
    return {
        year: date.getFullYear(),
        month: date.getMonth()
    }
}


getFormattedDate(date) {
    return `${date.getDate()}/${date.getMonth()}/${date.getFullYear()}`;
}

range(number) {
    return new Array(number).fill().map((e, i) => i);
}

getFirstElementInsideIdByClassName(className) {
    return document.getElementById(this.options.id).getElementsByClassName(className)[0];
}
}


(function () {
new CALENDAR({
    id: "calendar"
})
})();

{%endif%}

{% if user.usermembership.language.id == 2 %}

const AVAILABLE_WEEK_DAYS = ['Воскресения','Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Субота'];
const localStorageName = 'calendar-events';

class CALENDAR {
constructor(options) {
    this.options = options;
    this.elements = {
        days: this.getFirstElementInsideIdByClassName('calendar-days'),
        week: this.getFirstElementInsideIdByClassName('calendar-week'),
        month: this.getFirstElementInsideIdByClassName('calendar-month'),
        year: this.getFirstElementInsideIdByClassName('calendar-current-year'),
        currentDay: this.getFirstElementInsideIdByClassName('display_day'),
        currentWeekDay: this.getFirstElementInsideIdByClassName('calendar-left-side-day-of-week'),
        prevYear: this.getFirstElementInsideIdByClassName('calendar-change-year-slider-prev'),
        nextYear: this.getFirstElementInsideIdByClassName('calendar-change-year-slider-next')
    };



    this.date = +new Date();
    this.options.maxDays = 37;
    this.init();
}

// App methods
init() {
    if (!this.options.id) return false;
    this.eventsTrigger();
    this.drawAll();
}

// draw Methods
drawAll() {
    this.drawWeekDays();
    this.drawMonths();
    this.drawDays();
    this.drawYearAndCurrentDay();
    this.drawEvents();

}


drawYearAndCurrentDay() {
    let calendar = this.getCalendar();
    this.elements.year.innerHTML = calendar.active.year;
    this.elements.currentDay.innerHTML = calendar.active.day;
    this.elements.currentWeekDay.innerHTML = AVAILABLE_WEEK_DAYS[calendar.active.week];
}

drawDays() {
    let calendar = this.getCalendar();

    let latestDaysInPrevMonth = this.range(calendar.active.startWeek).map((day, idx) => {
        return {
            dayNumber: this.countOfDaysInMonth(calendar.pMonth) - idx,
            month: new Date(calendar.pMonth).getMonth(),
            year: new Date(calendar.pMonth).getFullYear(),
            currentMonth: false
        }
    }).reverse();


    let daysInActiveMonth = this.range(calendar.active.days).map((day, idx) => {
        let dayNumber = idx + 1;
        let today = new Date();
        return {
            dayNumber,
            today: today.getDate() === dayNumber && today.getFullYear() === calendar.active.year && today.getMonth() === calendar.active.month,
            month: calendar.active.month,
            year: calendar.active.year,
            selected: calendar.active.day === dayNumber,
            currentMonth: true
        }
    });


    let countOfDays = this.options.maxDays - (latestDaysInPrevMonth.length + daysInActiveMonth.length);
    let daysInNextMonth = this.range(countOfDays).map((day, idx) => {
        return {
            dayNumber: idx + 1,
            month: new Date(calendar.nMonth).getMonth(),
            year: new Date(calendar.nMonth).getFullYear(),
            currentMonth: false
        }
    });

    let days = [...latestDaysInPrevMonth, ...daysInActiveMonth, ...daysInNextMonth];

    days = days.map(day => {
        let newDayParams = day;
        let formatted = this.getFormattedDate(new Date(`${Number(day.month)}/${day.dayNumber}/${day.year}`));

        return newDayParams;
    });

    let daysTemplate = "";
    days.forEach(day => {
        daysTemplate += `<li class="${day.currentMonth ? '' : 'another-month'}${day.today ? ' active-day ' : ''}${day.selected ? 'selected-day' : ''}${day.hasEvent ? ' event-day' : ''}" data-day="${day.dayNumber}" data-month="${day.month}" data-year="${day.year}"></li>`
    });

    this.elements.days.innerHTML = daysTemplate;
}

drawMonths() {
    let availableMonths = ["Янв", "Фев", "Мар", "Апр", "Май", "Июн", "Июл", "Авг", "Сен", "Окт", "Нов", "Дек"];
    let monthTemplate = "";
    let calendar = this.getCalendar();
    availableMonths.forEach((month, idx) => {
        monthTemplate += `<li class="${idx === calendar.active.month ? 'active' : ''}" data-month="${idx}">${month}</li>`
    });

    this.elements.month.innerHTML = monthTemplate;
}

drawWeekDays() {
    let weekTemplate = "";
    AVAILABLE_WEEK_DAYS.forEach(week => {
        weekTemplate += `<li>${week.slice(0, 3)}</li>`
    });

    this.elements.week.innerHTML = weekTemplate;
}

// Service methods
eventsTrigger() {
    this.elements.prevYear.addEventListener('click', e => {
        let calendar = this.getCalendar();
        this.updateTime(calendar.pYear);
        this.drawAll()
    });

    this.elements.nextYear.addEventListener('click', e => {
        let calendar = this.getCalendar();
        this.updateTime(calendar.nYear);
        this.drawAll()
    });

    this.elements.month.addEventListener('click', e => {
        let calendar = this.getCalendar();
        let month = e.srcElement.getAttribute('data-month');
        if (!month || calendar.active.month == month) return false;

        let newMonth = new Date(calendar.active.tm).setMonth(month);
        this.updateTime(newMonth);
        this.drawAll()
    });


    this.elements.days.addEventListener('click', e => {
        let element = e.srcElement;
        let day = element.getAttribute('data-day');
        let month = element.getAttribute('data-month');
        let year = element.getAttribute('data-year');
        if (!day) return false;
        let strDate = `${Number(month) + 1}/${day}/${year}`;
        this.updateTime(strDate);
        this.drawAll()
    });


   


}


updateTime(time) {
    this.date = +new Date(time);
}

getCalendar() {
    let time = new Date(this.date);

    return {
        active: {
            days: this.countOfDaysInMonth(time),
            startWeek: this.getStartedDayOfWeekByTime(time),
            day: time.getDate(),
            week: time.getDay(),
            month: time.getMonth(),
            year: time.getFullYear(),
            formatted: this.getFormattedDate(time),
            tm: +time
        },
        pMonth: new Date(time.getFullYear(), time.getMonth() - 1, 1),
        nMonth: new Date(time.getFullYear(), time.getMonth() + 1, 1),
        pYear: new Date(new Date(time).getFullYear() - 1, 0, 1),
        nYear: new Date(new Date(time).getFullYear() + 1, 0, 1)
    }
}

countOfDaysInMonth(time) {
    let date = this.getMonthAndYear(time);
    return new Date(date.year, date.month + 1, 0).getDate();
}

getStartedDayOfWeekByTime(time) {
    let date = this.getMonthAndYear(time);
    return new Date(date.year, date.month, ).getDay();
}


getMonthAndYear(time) {
    let date = new Date(time);
    return {
        year: date.getFullYear(),
        month: date.getMonth()
    }
}


getFormattedDate(date) {
    return `${date.getDate()}/${date.getMonth()}/${date.getFullYear()}`;
}

range(number) {
    return new Array(number).fill().map((e, i) => i);
}

getFirstElementInsideIdByClassName(className) {
    return document.getElementById(this.options.id).getElementsByClassName(className)[0];
}
}


(function () {
new CALENDAR({
    id: "calendar"
})
})();

{%endif%}

{% if user.usermembership.language.id == 4 %}

const AVAILABLE_WEEK_DAYS = ['Неділя','Понеділок', 'Вівторок', 'Середа', 'Четвер', 'П\'ятница', 'Субота'];
const localStorageName = 'calendar-events';

class CALENDAR {
constructor(options) {
    this.options = options;
    this.elements = {
        days: this.getFirstElementInsideIdByClassName('calendar-days'),
        week: this.getFirstElementInsideIdByClassName('calendar-week'),
        month: this.getFirstElementInsideIdByClassName('calendar-month'),
        year: this.getFirstElementInsideIdByClassName('calendar-current-year'),
        currentDay: this.getFirstElementInsideIdByClassName('display_day'),
        currentWeekDay: this.getFirstElementInsideIdByClassName('calendar-left-side-day-of-week'),
        prevYear: this.getFirstElementInsideIdByClassName('calendar-change-year-slider-prev'),
        nextYear: this.getFirstElementInsideIdByClassName('calendar-change-year-slider-next')
    };



    this.date = +new Date();
    this.options.maxDays = 37;
    this.init();
}

// App methods
init() {
    if (!this.options.id) return false;
    this.eventsTrigger();
    this.drawAll();
}

// draw Methods
drawAll() {
    this.drawWeekDays();
    this.drawMonths();
    this.drawDays();
    this.drawYearAndCurrentDay();
    this.drawEvents();

}


drawYearAndCurrentDay() {
    let calendar = this.getCalendar();
    this.elements.year.innerHTML = calendar.active.year;
    this.elements.currentDay.innerHTML = calendar.active.day;
    this.elements.currentWeekDay.innerHTML = AVAILABLE_WEEK_DAYS[calendar.active.week];
}

drawDays() {
    let calendar = this.getCalendar();

    let latestDaysInPrevMonth = this.range(calendar.active.startWeek).map((day, idx) => {
        return {
            dayNumber: this.countOfDaysInMonth(calendar.pMonth) - idx,
            month: new Date(calendar.pMonth).getMonth(),
            year: new Date(calendar.pMonth).getFullYear(),
            currentMonth: false
        }
    }).reverse();


    let daysInActiveMonth = this.range(calendar.active.days).map((day, idx) => {
        let dayNumber = idx + 1;
        let today = new Date();
        return {
            dayNumber,
            today: today.getDate() === dayNumber && today.getFullYear() === calendar.active.year && today.getMonth() === calendar.active.month,
            month: calendar.active.month,
            year: calendar.active.year,
            selected: calendar.active.day === dayNumber,
            currentMonth: true
        }
    });


    let countOfDays = this.options.maxDays - (latestDaysInPrevMonth.length + daysInActiveMonth.length);
    let daysInNextMonth = this.range(countOfDays).map((day, idx) => {
        return {
            dayNumber: idx + 1,
            month: new Date(calendar.nMonth).getMonth(),
            year: new Date(calendar.nMonth).getFullYear(),
            currentMonth: false
        }
    });

    let days = [...latestDaysInPrevMonth, ...daysInActiveMonth, ...daysInNextMonth];

    days = days.map(day => {
        let newDayParams = day;
        let formatted = this.getFormattedDate(new Date(`${Number(day.month)}/${day.dayNumber}/${day.year}`));

        return newDayParams;
    });

    let daysTemplate = "";
    days.forEach(day => {
        daysTemplate += `<li class="${day.currentMonth ? '' : 'another-month'}${day.today ? ' active-day ' : ''}${day.selected ? 'selected-day' : ''}${day.hasEvent ? ' event-day' : ''}" data-day="${day.dayNumber}" data-month="${day.month}" data-year="${day.year}"></li>`
    });

    this.elements.days.innerHTML = daysTemplate;
}

drawMonths() {
    let availableMonths = ["Січ", "Лют", "Бер", "Кві", "Тра", "Чер", "Лип", "Сер", "Вер", "Жов", "Лис", "Гру"];
    let monthTemplate = "";
    let calendar = this.getCalendar();
    availableMonths.forEach((month, idx) => {
        monthTemplate += `<li class="${idx === calendar.active.month ? 'active' : ''}" data-month="${idx}">${month}</li>`
    });

    this.elements.month.innerHTML = monthTemplate;
}

drawWeekDays() {
    let weekTemplate = "";
    AVAILABLE_WEEK_DAYS.forEach(week => {
        weekTemplate += `<li>${week.slice(0, 3)}</li>`
    });

    this.elements.week.innerHTML = weekTemplate;
}

// Service methods
eventsTrigger() {
    this.elements.prevYear.addEventListener('click', e => {
        let calendar = this.getCalendar();
        this.updateTime(calendar.pYear);
        this.drawAll()
    });

    this.elements.nextYear.addEventListener('click', e => {
        let calendar = this.getCalendar();
        this.updateTime(calendar.nYear);
        this.drawAll()
    });

    this.elements.month.addEventListener('click', e => {
        let calendar = this.getCalendar();
        let month = e.srcElement.getAttribute('data-month');
        if (!month || calendar.active.month == month) return false;

        let newMonth = new Date(calendar.active.tm).setMonth(month);
        this.updateTime(newMonth);
        this.drawAll()
    });


    this.elements.days.addEventListener('click', e => {
        let element = e.srcElement;
        let day = element.getAttribute('data-day');
        let month = element.getAttribute('data-month');
        let year = element.getAttribute('data-year');
        if (!day) return false;
        let strDate = `${Number(month) + 1}/${day}/${year}`;
        this.updateTime(strDate);
        this.drawAll()
    });


   


}


updateTime(time) {
    this.date = +new Date(time);
}

getCalendar() {
    let time = new Date(this.date);

    return {
        active: {
            days: this.countOfDaysInMonth(time),
            startWeek: this.getStartedDayOfWeekByTime(time),
            day: time.getDate(),
            week: time.getDay(),
            month: time.getMonth(),
            year: time.getFullYear(),
            formatted: this.getFormattedDate(time),
            tm: +time
        },
        pMonth: new Date(time.getFullYear(), time.getMonth() - 1, 1),
        nMonth: new Date(time.getFullYear(), time.getMonth() + 1, 1),
        pYear: new Date(new Date(time).getFullYear() - 1, 0, 1),
        nYear: new Date(new Date(time).getFullYear() + 1, 0, 1)
    }
}

countOfDaysInMonth(time) {
    let date = this.getMonthAndYear(time);
    return new Date(date.year, date.month + 1, 0).getDate();
}

getStartedDayOfWeekByTime(time) {
    let date = this.getMonthAndYear(time);
    return new Date(date.year, date.month, ).getDay();
}


getMonthAndYear(time) {
    let date = new Date(time);
    return {
        year: date.getFullYear(),
        month: date.getMonth()
    }
}


getFormattedDate(date) {
    return `${date.getDate()}/${date.getMonth()}/${date.getFullYear()}`;
}

range(number) {
    return new Array(number).fill().map((e, i) => i);
}

getFirstElementInsideIdByClassName(className) {
    return document.getElementById(this.options.id).getElementsByClassName(className)[0];
}
}


(function () {
new CALENDAR({
    id: "calendar"
})
})();

{%endif%}

</script>

    
    {% include 'partials/_background_image.html' %}


    {% endblock  %}